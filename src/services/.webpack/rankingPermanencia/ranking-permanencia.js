!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";var r,o=n(0),i=(r=o)&&r.__esModule?r:{default:r};const{connect:a}=n(4),c=n(7),{ObjectId:s}=n(9),{format:u,formatDistance:l,formatRelative:d,subDays:f,differenceInDays:p}=n(10);e.exports.handler=async(e,t,n)=>{t.callbackWaitsForEmptyEventLoop=!1;try{const t=e.Records[0].body;await a();let r=await c.findById(new s(t.id));const o=r.positions,u=[];for(const e of o){const t=e.date1.split("â€“"),n=t[0].trim(),r=t[1].trim(),o=n.match(/^([A-Za-z]{3}).*([0-9]{4})/i),i=new Date(`${o[1]} ${o[2]}`);let a=new Date;if(!/moment/.test(r)){const e=r.match(/^([A-Za-z]{3}).*([0-9]{4})/i);a=new Date(`${e[1]} ${e[2]}`)}const c=p(a,i);u.push({begin:i,end:a,difference:c,avgDifference:c/365})}const l=2,d=5*(u.reduce((e,t)=>e+=t.avgDifference,0)/u.length)/l;return n(null,{statusCode:200,body:r=await c.findOneAndUpdate({_id:new s(t.id)},{$set:{ranking:{permanencia:d}}},{new:!0})})}catch(e){return n(null,{statusCode:400,body:(0,i.default)({error:e.message})})}}},function(e,t,n){"use strict";var r=i(n(1)),o=i(n(0));function i(e){return e&&e.__esModule?e:{default:e}}const a=n(2),{getSecret:c}=n(5);let s,u=!1;const l=(e,t)=>t&&t.constructor===RegExp?t.toString():"str"!==e?t:void 0,d=(e,t,n,r)=>{process.stdout.write(`${e}.${t}(${(0,o.default)(n,l)}`),r?process.stdout.write(`,${(0,o.default)(r,l)})\n`):process.stdout.write(")\n")};e.exports={connect:(e=!1)=>new r.default(async(t,n)=>{try{if(e&&a.set("debug",d),u)return console.log("===> Aproveitando conexao"),t(s);const r=await c("mongodb_uri");return console.log(r),(s=await a.connect(r,{reconnectTries:Number.MAX_VALUE,reconnectInterval:1e3}))===a?(u=!0,t(s)):n("error")}catch(e){return console.log("===> connect error",e),n(e)}}),disconnect:()=>new r.default(async(e,t)=>{try{a.connection.close(()=>{u=!1,console.log("===> Desconectando conexao"),e()})}catch(e){return console.log("===> disconnect error",e),t(e)}}),mongoose:a}},function(e,t,n){"use strict";var r,o=n(1),i=(r=o)&&r.__esModule?r:{default:r};const a=new(n(6).SSM)({region:process.env.AWS_REGION});let c,s=new Date(0);const u=e=>c[e],l=()=>new i.default((e,t)=>{c={};try{const n=async t=>{const r=await a.getParametersByPath(t).promise();console.log(r);for(const e of r.Parameters){const n=e.Name.replace(`${t.Path}/`,"");c[n]=e.Value}if(!r.NextToken)return s=new Date((new Date).getTime()+18e4),e(c);t.NextToken=r.NextToken,n(t)};return n({Recursive:!0,WithDecryption:!0})}catch(e){return t("Not Found Secret")}});e.exports={getSecret:e=>new i.default(async(t,n)=>{try{let r;if(new Date>=s&&(c=null),c){if(r=u(e))return t(r);throw"Not Found Secret."}if(await l(),c)return(r=u(e))?t(r):n("Not Found Secret!")}catch(e){return n("Not Found Secret")}}),getAll:l}},function(e,t){e.exports=require("aws-sdk")},function(e,t,n){"use strict";var r,o=n(2),i=(r=o)&&r.__esModule?r:{default:r};i.default.Promise=n(8);const a=new o.Schema({url:{type:String,require:!0,index:{unique:!0}},status:{type:String,enum:["created","updated","modernize"],require:!0},name:String,headline:String,location:String,summary:String,positions:[{_id:!1,title:{type:String},company:{type:String},description:{type:String},date1:{type:String},date2:{type:String},roles:[{_id:!1,title:{type:String},company:{type:String},description:{type:String},date1:{type:String},date2:{type:String}}]}],educations:[{_id:!1,title:String,degree:String,date1:Date,date2:Date}],skills:[{_id:!1,title:String,count:Number}],search:[{_id:!1,position:String,location:String}],ranking:{_id:!1,permanencia:String},date:{type:Date,default:Date.now},update:{type:Date,default:Date.now}});global.modelSchema=global.modelSchema||i.default.model("Perfil",a),e.exports=global.modelSchema},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("mongodb")},function(e,t){e.exports=require("date-fns")}]));
//# sourceMappingURL=ranking-permanencia.js.map