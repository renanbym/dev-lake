!function(e,t){for(var n in t)e[n]=t[n]}(exports,function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t){e.exports=require("babel-runtime/core-js/json/stringify")},function(e,t){e.exports=require("babel-runtime/core-js/promise")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("aws-sdk")},function(e,t,n){"use strict";var r,o=n(0),s=(r=o)&&r.__esModule?r:{default:r};const i=n(5),{connect:c}=n(6),a=n(8),{requestQueue:u}=n(10);e.exports.handler=async(e,t,n)=>{t.callbackWaitsForEmptyEventLoop=!1;try{const t=(e=>e.isOffline?e:JSON.parse(e.body))(e);await c();const r=await i({"no-display":!0,"only-urls":!0,limit:100,query:`site:linkedin.com/in/ AND "${t.position}" AND "${t.location}"`}),o=async e=>{const n=await a.update({url:e},{$set:{url:e,status:"created"},$addToSet:{search:{position:t.position,location:t.location}}},{upsert:!0,new:!0});await u({id:n._id},"updateProfileQueue")};for(const e of r)/^https?\:\/\/[a-z]{0,2}?\.linkedin\.com\/in\//.test(e.link)&&await o(e.link);return n(null,{statusCode:200,body:(0,s.default)({search:r})})}catch(e){return n(null,{statusCode:400,body:(0,s.default)({error:e.message})})}}},function(e,t){e.exports=require("google-it")},function(e,t,n){"use strict";var r=s(n(1)),o=s(n(0));function s(e){return e&&e.__esModule?e:{default:e}}const i=n(2),{getSecret:c}=n(7);let a,u=!1;const l=(e,t)=>t&&t.constructor===RegExp?t.toString():"str"!==e?t:void 0,p=(e,t,n,r)=>{process.stdout.write(`${e}.${t}(${(0,o.default)(n,l)}`),r?process.stdout.write(`,${(0,o.default)(r,l)})\n`):process.stdout.write(")\n")};e.exports={connect:(e=!1)=>new r.default(async(t,n)=>{try{if(e&&i.set("debug",p),u)return console.log("===> Aproveitando conexao"),t(a);const r=await c("mongodb_uri");return console.log(r),(a=await i.connect(r,{reconnectTries:Number.MAX_VALUE,reconnectInterval:1e3}))===i?(u=!0,t(a)):n("error")}catch(e){return console.log("===> connect error",e),n(e)}}),disconnect:()=>new r.default(async(e,t)=>{try{i.connection.close(()=>{u=!1,console.log("===> Desconectando conexao"),e()})}catch(e){return console.log("===> disconnect error",e),t(e)}}),mongoose:i}},function(e,t,n){"use strict";var r,o=n(1),s=(r=o)&&r.__esModule?r:{default:r};const i=new(n(3).SSM)({region:process.env.AWS_REGION});let c,a=new Date(0);const u=e=>c[e],l=()=>new s.default((e,t)=>{c={};try{const n=async t=>{const r=await i.getParametersByPath(t).promise();console.log(r);for(const e of r.Parameters){const n=e.Name.replace(`${t.Path}/`,"");c[n]=e.Value}if(!r.NextToken)return a=new Date((new Date).getTime()+18e4),e(c);t.NextToken=r.NextToken,n(t)};return n({Recursive:!0,WithDecryption:!0})}catch(e){return t("Not Found Secret")}});e.exports={getSecret:e=>new s.default(async(t,n)=>{try{let r;if(new Date>=a&&(c=null),c){if(r=u(e))return t(r);throw"Not Found Secret."}if(await l(),c)return(r=u(e))?t(r):n("Not Found Secret!")}catch(e){return n("Not Found Secret")}}),getAll:l}},function(e,t,n){"use strict";var r,o=n(2),s=(r=o)&&r.__esModule?r:{default:r};s.default.Promise=n(9);const i=new o.Schema({url:{type:String,require:!0,index:{unique:!0}},status:{type:String,enum:["created","updated","modernize"],require:!0},name:String,headline:String,location:String,summary:String,positions:[{_id:!1,title:{type:String},company:{type:String},description:{type:String},date1:{type:String},date2:{type:String},roles:[{_id:!1,title:{type:String},company:{type:String},description:{type:String},date1:{type:String},date2:{type:String}}]}],educations:[{_id:!1,title:String,degree:String,date1:Date,date2:Date}],skills:[{_id:!1,title:String,count:Number}],search:[{_id:!1,position:String,location:String}],ranking:{_id:!1,permanencia:String},date:{type:Date,default:Date.now},update:{type:Date,default:Date.now}});global.modelSchema=global.modelSchema||s.default.model("Perfil",i),e.exports=global.modelSchema},function(e,t){e.exports=require("bluebird")},function(e,t,n){"use strict";var r,o=n(0),s=(r=o)&&r.__esModule?r:{default:r};const i=n(3),c=process.env.AWS_REGION,a=process.env.STAGE,u=process.env.SERVERLESS_SERVICE;e.exports={buildSns:async(e,t,n="123456789012")=>{if("testing"===process.env.ENV||process.env.IS_OFFLINE||process.env.IS_LOCAL)return!0;let r=new i.SNS;const o={};"object"==typeof e&&(o.MessageStructure="json",e=(0,s.default)({default:(0,s.default)(e)})),process.env.IS_LOCAL||process.env.IS_OFFLINE?(r=new i.SNS({endpoint:"http://127.0.0.1:4002",region:c}),o.Message=e,o.TopicArn=`arn:aws:sns:${c}:${n}:${t}${a}`):(n=process.env.ACCOUNT_ID,o.Message=e,o.TopicArn=`arn:aws:sns:${c}:${n}:${t}${a}`),await r.publish(o).promise()},requestLambda:(e,t,n=null,r=!1)=>{if("testing"===process.env.ENV||process.env.IS_OFFLINE||process.env.IS_LOCAL)return!0;let o;o=(process.env.IS_LOCAL||process.env.IS_OFFLINE)&&r?new i.Lambda({endpoint:r.endpoint}):new i.Lambda;const c={FunctionName:`${n||u}-${a}-${t}`,InvocationType:"Event",Payload:(0,s.default)(e)};return o.invoke(c).promise()},requestQueue:async(e,t,n=null)=>{if("testing"===process.env.ENV||process.env.IS_OFFLINE||process.env.IS_LOCAL)return!0;const r=n||u,o=`https://sqs.us-east-1.amazonaws.com/${process.env.IS_LOCAL||process.env.IS_OFFLINE?process.env.DEV_ACCOUNT_ID:process.env.ACCOUNT_ID}/${r}-${a}-${t}`,l=new i.SQS({region:c});"object"==typeof e&&(e=(0,s.default)(e));const p={MessageBody:e,QueueUrl:o};return l.sendMessage(p).promise()},deleteMessage:(e,t,n=null)=>{if("testing"===process.env.ENV||process.env.IS_OFFLINE||process.env.IS_LOCAL)return!0;const r=n||u,o=process.env.IS_LOCAL||process.env.IS_OFFLINE?process.env.DEV_ACCOUNT_ID:process.env.ACCOUNT_ID,s={QueueUrl:process.env.IS_LOCAL||process.env.IS_OFFLINE?`http://localhost:4576/queue/${e}`:`https://sqs.us-east-1.amazonaws.com/${o}/${r}-${a}-${e}`,ReceiptHandle:t};return new i.SQS({region:c}).deleteMessage(s).promise()}}}]));
//# sourceMappingURL=search-google.js.map